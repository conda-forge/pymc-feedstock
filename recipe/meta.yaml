{% set version = "4.1.1" %}

package:
  name: pymc-suite  # https://github.com/conda/conda-build/issues/3933
  version: {{ version }}

source:
  url: https://pypi.io/packages/source/p/pymc/pymc-{{ version }}.tar.gz
  sha256: cda36c7ef1870cc8ee28b7acc1b362024badc62d9af9dff12e04d96ae4b50cf0

build:
  number: 0
  skip: true  # [py<38]

outputs:
  - name: pymc-base
    build:
      script:
        - python -m pip install . --no-deps -vv
    requirements:
      host:
        - python
        - pip
      run:
        - python
        # https://github.com/pymc-devs/pymc/blob/v{{ version }}/requirements.txt
        - aeppl ==0.0.31
        - aesara-base ==2.7.4
        - arviz >=0.12.0
        - cachetools >=4.2.1
        - cloudpickle
        - fastprogress >=0.2.0
        - numpy >=1.15.0
        - pandas >=0.24.0
        - scipy >=1.4.1
        - typing-extensions >=3.7.4
    test:
      imports:
        - pymc
        - pymc.backends
        - pymc.distributions
        - pymc.gp
        - pymc.step_methods
        - pymc.tests
        - pymc.tuning
        - pymc.variational
        - pymc.ode
      commands:
        - pip check
        - python check-for-warnings.py allowed-warnings-base.txt
      requires:
        - pip
      files:
        - check-for-warnings.py
        - allowed-warnings-base.txt
  - name: pymc
    requirements:
      host:
        - python
      run:
        - python
        - {{ pin_subpackage("pymc-base", exact=True) }}
        # This last part with =*_1 is a temporary workaround since there are two
        # builds for aesara-base v2.7.4 labeled like xyz_0 and abc_1.
        # In the next version, we should remove this line and uncomment the subsequent
        # lines.
        - aesara ==2.7.4=*_1
        # # As of Aesara v2.7.5, there is a 1-1 correspondence between the "aesara-base"
        # # package and the "aesara" package of the same version and build number on
        # # which it depends. Thus the pin from the "aesara-base" package above will
        # # implicitly transfer here to the "aesara" package.
        # - aesara >=2.7.5
    test:
      imports:
        - pymc
        - pymc.backends
        - pymc.distributions
        - pymc.gp
        - pymc.step_methods
        - pymc.tests
        - pymc.tuning
        - pymc.variational
        - pymc.ode
      commands:
        - pip check
        - python check-for-warnings.py allowed-warnings-main.txt
      requires:
        - pip
      files:
        - check-for-warnings.py
        - allowed-warnings-main.txt

about:
  home: http://github.com/pymc-devs/pymc
  license: Apache-2.0
  license_file: LICENSE
  license_family: Apache
  summary: Probabilistic Programming in Python

extra:
  recipe-maintainers:
    - ericmjl
    - twiecki
    - fonnesbeck
    - ocefpaf
    - michaelosthege
    - maresb
    - ricardoV94
