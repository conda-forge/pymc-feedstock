{% set version = "4.2.2" %}

package:
  name: pymc-suite  # https://github.com/conda/conda-build/issues/3933
  version: {{ version }}

source:
  url: https://pypi.io/packages/source/p/pymc/pymc-{{ version }}.tar.gz
  sha256: 468e310410c10ed2d8d88e307449f8d0b1aed2079d283648b555d36439e597e1

build:
  number: 0

outputs:
  - name: pymc-base
    build:
      noarch: python
      script:
        - python -m pip install . --no-deps -vv
    requirements:
      host:
        - python >=3.8
        - pip
      run:
        - python >=3.8
        # https://github.com/pymc-devs/pymc/blob/v{{ version }}/requirements.txt
        - aeppl-base ==0.0.38
        - aesara-base ==2.8.7
        - arviz >=0.12.0
        - cachetools >=4.2.1
        - cloudpickle
        - fastprogress >=0.2.0
        - numpy >=1.15.0
        - pandas >=0.24.0
        - scipy >=1.4.1
        - typing-extensions >=3.7.4
    test:
      imports:
        - pymc
        - pymc.backends
        - pymc.distributions
        - pymc.gp
        - pymc.step_methods
        - pymc.tests
        - pymc.tuning
        - pymc.variational
        - pymc.ode
      commands:
        - pip check
        - python check-for-warnings.py allowed-warnings-base.txt
      requires:
        - pip
      files:
        - check-for-warnings.py
        - allowed-warnings-base.txt
  - name: pymc
    build:
      noarch: python
      script:
        - echo "Nothing to build here, just add dependencies."
    requirements:
      run:
        - {{ pin_subpackage("pymc-base", exact=True) }}
        # As of Aesara v2.7.5, there is a 1-1 correspondence between the "aesara-base"
        # package and the "aesara" package of the same version and build number on
        # which it depends. Thus the pin from the "aesara-base" package above will
        # implicitly transfer here to the "aesara" package.
        - aesara >=2.7.5

        # The same story for aeppl:
        # As of aeppl v0.0.32, there is a 1-1 correspondence between the "aeppl-base"
        # package and the "aeppl" package of the same version and build number on
        # which it depends. Thus the pin from the "aeppl-base" package above will
        # implicitly transfer here to the "aeppl" package.
        - aeppl >=0.0.32
    test:
      imports:
        - pymc
        - pymc.backends
        - pymc.distributions
        - pymc.gp
        - pymc.step_methods
        - pymc.tests
        - pymc.tuning
        - pymc.variational
        - pymc.ode
      commands:
        - pip check
        - python check-for-warnings.py allowed-warnings-main.txt
      requires:
        - pip
      files:
        - check-for-warnings.py
        - allowed-warnings-main.txt

about:
  home: http://github.com/pymc-devs/pymc
  license: Apache-2.0
  license_file: LICENSE
  license_family: Apache
  summary: Probabilistic Programming in Python

extra:
  recipe-maintainers:
    - ericmjl
    - twiecki
    - fonnesbeck
    - ocefpaf
    - michaelosthege
    - maresb
    - ricardoV94
